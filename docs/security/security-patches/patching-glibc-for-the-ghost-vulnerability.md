---
author:
  name: James Stewart
  email: jstewart@linode.com
description: 'Instructions on upgrading your Linode against the GHOST vulnerability.'
keywords: 'bash,ghost,security,patch,ubuntu,debian,centos,fedora,upgrade'
license: '[CC BY-ND 3.0](http://creativecommons.org/licenses/by-nd/3.0/us/)'
modified: Wednesday, January 28th, 2015
modified_by:
  name: James Stewart
published: 'Monday, September 29, 2014'
title: Upgrading Glibc for the GHOST Vulnerability
---

GHOST is a vulnerability that was announced on January 27th 2015, which affect the Glibc C library on Linux systems.  This vulnerability affects all Linux distributions running versions of glibc older than 2.18, and exploits a buffer overflow in the gethostname() function. This guide will tell you how to safely upgrade your Linux distributions and secure your Linode against the GHOST vulnerability.

#Affected Distributions/Versions

Patches are currently available for:
Debian 7
CentOS 6 & 7
Ubuntu 12.04.

Distributions that are unaffected are as follows:
Fedora 20 & 21
Ubuntu 14.04 and 14.10

Prior unsupported versions of the listed distributions may not have patches available.  It is recommended to upgrade any systems still running unsupported distributions.

# Checking the Vulnerability

You must first see if you are vulnerable.

1.  Create a GHOST.c file with the following contents.

    {: .file-excerpt}
    ~/GHOST.c
    :   ~~~ C
		#include <netdb.h>
		#include <stdio.h>
		#include <stdlib.h>
		#include <string.h>
		#include <errno.h>

		#define CANARY "in_the_coal_mine"

		struct {
		  char buffer[1024];
		  char canary[sizeof(CANARY)];
		} temp = { "buffer", CANARY };

		int main(void) {
		  struct hostent resbuf;
		  struct hostent *result;
		  int herrno;
		  int retval;

		  /*** strlen (name) = size_needed - sizeof (*host_addr) - sizeof (*h_addr_ptrs) - 1; ***/
		  size_t len = sizeof(temp.buffer) - 16*sizeof(unsigned char) - 2*sizeof(char *) - 1;
		  char name[sizeof(temp.buffer)];
		  memset(name, '0', len);
		  name[len] = '\0';

		  retval = gethostbyname_r(name, &resbuf, temp.buffer, sizeof(temp.buffer), &result, &herrno);

		  if (strcmp(temp.canary, CANARY) != 0) {
		    puts("vulnerable");
		    exit(EXIT_SUCCESS);
		  }
		  if (retval == ERANGE) {
		    puts("not vulnerable");
		    exit(EXIT_SUCCESS);
		  }
		  puts("should not happen");
		  exit(EXIT_FAILURE);
		}
		EOF
		~~~

2.  Compile the script.

		gcc GHOST.c -o GHOST

3.  Execute the compiled GHOST script.  Your terminal should print "vulnerable" or "not vulnerable" depening on your system's status.

		./GHOST


# Installing the Upgrade

Below is the relevant information for upgrading Glibc and ensuring that your Linode is no longer vulnerable to the bug. Each section is designed for individual distributions. The sections are written with the assumption that you have root access or sudo privileges. If you do not, you will not be able to run these commands.

{: .note}
>You will need to reboot after completing your upgrade to ensure that the vulnerable code no longer remains in your system memory.  Once you have rebooted, we would recommend re-running the script created in the "Checking The Vulnerability" section to confirm that the patch has been applied

## Ubuntu and Debian

To upgrade glibc on Ubuntu and Debian, run these commands to update and upgrade via the package manager. If you are not running as the root user, prepend `sudo` to each command:

	apt-get update
	apt-get dist-upgrade

## CentOS and Fedora

To upgrade glibc on yum based systems such as CentOS and Fedora, run these commands to update and upgrade via the package manager. If you are not running as the root user, prepend `sudo` to each command:

	yum clean all
	yum update

More Information
----------------

You may wish to consult the following resources for additional information on this topic. While these are provided in the hope that they will be useful, please note that we cannot vouch for the accuracy or timeliness of externally hosted materials.

- [CVE-2015-0235](http://www.openwall.com/lists/oss-security/2015/01/27/9)
